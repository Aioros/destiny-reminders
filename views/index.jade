extends layout

block content
	main.text-light
		div.container
			div#selection_header.row.d-none
				div.col-6.name
				div.col-6
					button#close_selection.close(type="button", aria-label="Close")
						span &times;
			div#main_selection.row
				each category, key in wishlist
					- var isNeeded = category.values.some(choice => choice.neededFor.some(f => f.value));
					div.col-12.col-sm-6.col-md-4.col-lg-3
						div.container.category(
							id="category_" + key,
							class=isNeeded ? "needed" : "",
							data-category=key,
							data-needed=isNeeded,
							data-description=helpers.capitalize(category.description)
						)
							div.row.h-100.no-gutters.align-items-center
								div.col-3
									img.category-icon.mw-100(src="/img/"+key+".png")
								div.col-9.pl-2= helpers.capitalize(category.description)
			div#parked.d-none
				each category, key in wishlist
					each choice in category.values
						-
							var isCurrent = helpers.isCurrent(key, choice.name, current);
							var neededFor = choice.neededFor.filter(f => f.value);
						div.col-12
							div.choice(
								class=isCurrent ? "current" : "",
								class=neededFor.length > 0 ? "needed" : "",
								data-category=key,
								data-choice=helpers.capitalize(choice.name)
								data-needed=neededFor.length > 0,
								data-needed-for=JSON.stringify(neededFor),
								data-current=isCurrent
							)= helpers.capitalize(choice.name)
			
			div#reminder_modal.modal(tabindex="-1")
				div.modal-dialog
					div.modal-content
						div.modal-header
							h5.modal-title Modal title
							button.close.close-modal(type="button", aria-label="Close")
								span(aria-hidden="true") &times;
						form
							div.modal-body
								div.form-group
									small#reminder_current.form-text.d-none This activity is available now
									small#reminder_needed.form-text.d-none
								div.form-group
									label(for="reminder_email") Email
									input#reminder_email.form-control(type="email", required, disabled=!user, name="reminder_email", aria-describedby="email_help")
									small#email_help.form-text.text-muted We'll never share your email with anyone else.
							div.modal-footer
								button.btn.btn-secondary.close-modal(type="button") Close
								if user
									button#set_reminder.btn.btn-light(type="submit")
										span.spinner(role="status", aria-hidden="true")
										| Set Reminder
								else
									a#reminder_login.btn.btn-warning(href="/auth/login") Login to set reminder

			//-
				select(id="category")
					option(value="") Choose a category
					each val, key in wishlist
						option(
							value=key
						)= helpers.capitalize(val.description)
				each val, key in wishlist
					select(class="choices hidden" id=key + "_choices")
						each choice in val.values
							option(value=choice.name)= helpers.capitalize(choice.name) + (helpers.isCurrent(key, choice.name, current) ? " (current)" : "") + (choice.neededFor.some(f => f.value) ? " (needed for " + choice.neededFor.filter(f => f.value).map(f => f.name).join(", ") + ")" : "")
				div(id="reminder" class="hidden")
					label Email
					input(type="email", id="email")
					button(id="setreminder") Set Reminder
				div(id="loading" class="hidden") Loading
				if !user
					div(class="logged-out")
						a(href="/auth/login") Login
				else
					div(class="logged-in")
						p= "User: " + user.bungieNetUser.displayName + " (" + user.bungieNetUser.membershipId + ")"
						div(id="user_reminders")
							h2 Your reminders
							table
								thead
									th Category
									th Choice
									th Email
									th
								tbody
									tr(class="reminder placeholder")
										td(class="category")
										td(class="choice")
										td(class="email")
										td(class="delete") x
						a(href="/auth/logout") Logout